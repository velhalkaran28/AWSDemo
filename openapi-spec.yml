openapi: 3.0.3
info:
  title: VPC Management API
  version: 2.0.0
  description: |
    API to manage VPC
  contact:
    name: Karan
    email: support@example.com

servers:
  - url: https://ssd83nszoa.execute-api.us-east-1.amazonaws.com
    description: Production server

tags:
  - name: VPC
    description: VPC management

security:
  - ApiKeyAuth: []

paths:
  /vpcs:
    get:
      tags:
        - VPC
      summary: List all VPCs
      description: Retrieves all VPCs
      operationId: listVPCs
      responses:
        '200':
          description: Successful response with list of all VPCs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListVPCResponse'
              example:
                vpcs:
                  - vpc_id: "vpc-12345678"
                    created_at: "2025-12-07T10:00:00.000Z"
                    created_by: "api-user"
                    vpc_cidr: "10.0.0.0/16"
                    vpc_name: "my-vpc"
                    status: "created"
                    subnets:
                      - subnet_id: "subnet-11111111"
                        cidr_block: "10.0.1.0/24"
                        availability_zone: "us-east-1a"
                        name: "public-subnet-1"
                  - vpc_id: "vpc-87654321"
                    created_at: "2025-12-07T11:00:00.000Z"
                    created_by: "admin"
                    vpc_cidr: "10.1.0.0/16"
                    vpc_name: "another-vpc"
                    status: "created"
                    subnets:
                      - subnet_id: "subnet-22222222"
                        cidr_block: "10.1.1.0/24"
                        availability_zone: "us-east-1b"
                        name: "subnet-1"
                count: 2
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - VPC
      summary: Create a new VPC
      description: Creates a new VPC with specified CIDR block and subnets
      operationId: createVPC
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateVPCRequest'
            examples:
              minimal:
                summary: Minimal VPC (recommended)
                value:
                  cidr_block: "10.0.0.0/16"
                  vpc_name: "my-vpc"
                  subnets:
                    - cidr_block: "10.0.1.0/24"
                      name: "subnet-1"
              multipleSubnets:
                summary: VPC with multiple subnets
                value:
                  cidr_block: "10.0.0.0/16"
                  vpc_name: "production-vpc"
                  subnets:
                    - cidr_block: "10.0.1.0/24"
                      name: "public-subnet"
                    - cidr_block: "10.0.2.0/24"
                      name: "private-subnet"
              withAZ:
                summary: VPC with specific availability zones
                value:
                  cidr_block: "10.0.0.0/16"
                  vpc_name: "vpc-with-az"
                  subnets:
                    - cidr_block: "10.0.1.0/24"
                      name: "subnet-1a"
                      availability_zone: "us-east-1a"
                    - cidr_block: "10.0.2.0/24"
                      name: "subnet-1b"
                      availability_zone: "us-east-1b"
      responses:
        '201':
          description: VPC created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateVPCResponse'
              example:
                message: "VPC created successfully"
                vpc_id: "vpc-12345678"
                vpc_cidr: "10.0.0.0/16"
                created_at: "2025-12-07T10:00:00.000Z"
                created_by: "api-user"
                subnets:
                  - subnet_id: "subnet-11111111"
                    cidr_block: "10.0.1.0/24"
                    availability_zone: "us-east-1a"
                    name: "subnet-1"
        '400':
          description: Bad request 
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingField:
                  summary: Missing required field
                  value:
                    error: "Validation failed"
                    message: "cidr_block is required"
                missingSubnet:
                  summary: Missing subnet
                  value:
                    error: "Validation failed"
                    message: "at least one subnet is required"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /vpcs/{vpc_id}:
    get:
      tags:
        - VPC
      summary: Get VPC by ID
      description: Retrieves detailed information about a specific VPC
      operationId: getVPC
      parameters:
        - name: vpc_id
          in: path
          description: The unique AWS VPC identifier
          required: true
          schema:
            type: string
          example: vpc-12345678
      responses:
        '200':
          description: VPC details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VPCResource'
              example:
                vpc_id: "vpc-12345678"
                created_at: "2025-12-07T10:00:00.000Z"
                created_by: "api-user"
                vpc_cidr: "10.0.0.0/16"
                vpc_name: "my-vpc"
                status: "created"
                subnets:
                  - subnet_id: "subnet-11111111"
                    cidr_block: "10.0.1.0/24"
                    availability_zone: "us-east-1a"
                    name: "public-subnet-1"
        '404':
          description: VPC not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "VPC not found"
                message: "VPC with ID vpc-12345678 does not exist"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
      description: API key for authentication (required for all endpoints)

  schemas:
    VPCResource:
      type: object
      description: VPC resource with metadata
      required:
        - vpc_id
        - created_at
        - created_by
        - vpc_cidr
        - vpc_name
        - status
        - subnets
      properties:
        vpc_id:
          type: string
          description: AWS VPC identifier
          example: vpc-12345678
        created_at:
          type: string
          format: date-time
          description: time of VPC creation
          example: "2025-12-07T10:00:00.000Z"
        created_by:
          type: string
          description: Who created the VPC
          example: "api-user"
        vpc_cidr:
          type: string
          description: CIDR block of the VPC
          example: "10.0.0.0/16"
        vpc_name:
          type: string
          description: Name tag of the VPC
          example: "my-vpc"
        status:
          type: string
          description: Current status of the VPC
          enum: [created, available, pending, deleting, deleted]
          example: "created"
        subnets:
          type: array
          description: List of subnets in this VPC
          items:
            $ref: '#/components/schemas/SubnetResult'

    SubnetResult:
      type: object
      description: Subnet information
      required:
        - subnet_id
        - cidr_block
        - availability_zone
        - name
      properties:
        subnet_id:
          type: string
          description: AWS Subnet identifier
          example: subnet-11111111
        cidr_block:
          type: string
          description: CIDR block of the subnet
          example: "10.0.1.0/24"
        availability_zone:
          type: string
          description: AWS availability zone where subnet is created
          example: "us-east-1a"
        name:
          type: string
          description: Name tag of the subnet
          example: "public-subnet-1"

    CreateVPCRequest:
      type: object
      description: Request to create a new VPC
      required:
        - cidr_block
        - vpc_name
        - subnets
      properties:
        cidr_block:
          type: string
          description: CIDR block for the VPC
          example: "10.0.0.0/16"
        vpc_name:
          type: string
          description: Name for the VPC
          minLength: 1
          maxLength: 255
          example: "my-vpc"
        subnets:
          type: array
          description: List of subnets to create in the VPC
          minItems: 1
          items:
            $ref: '#/components/schemas/SubnetRequest'

    SubnetRequest:
      type: object
      description: Subnet configuration for VPC creation
      required:
        - cidr_block
        - name
      properties:
        cidr_block:
          type: string
          description: CIDR block for the subnet
          example: "10.0.1.0/24"
        name:
          type: string
          description: Name for the subnet
          minLength: 1
          maxLength: 255
          example: "subnet-1"
        availability_zone:
          type: string
          description: AWS availability zone
          example: "us-east-1a"

    CreateVPCResponse:
      type: object
      description: Response after successfully creating a VPC
      required:
        - message
        - vpc_id
        - vpc_cidr
        - subnets
        - created_at
        - created_by
      properties:
        message:
          type: string
          description: Success message
          example: "VPC created successfully"
        vpc_id:
          type: string
          description: AWS VPC identifier of the created VPC
          example: "vpc-12345678"
        vpc_cidr:
          type: string
          description: CIDR block of the created VPC
          example: "10.0.0.0/16"
        subnets:
          type: array
          description: List of created subnets
          items:
            $ref: '#/components/schemas/SubnetResult'
        created_at:
          type: string
          format: date-time
          description: time of VPC creation
          example: "2025-12-07T10:00:00.000Z"
        created_by:
          type: string
          description: user who created the VPC
          example: "api-user"

    ListVPCResponse:
      type: object
      description: Complete list of all VPCs
      required:
        - vpcs
        - count
      properties:
        vpcs:
          type: array
          description: Array of all VPC resources
          items:
            $ref: '#/components/schemas/VPCResource'
        count:
          type: integer
          description: Total number of VPCs returned
          example: 5

    ErrorResponse:
      type: object
      description: Error response structure
      required:
        - error
      properties:
        error:
          type: string
          description: Error category or type
          example: "Validation failed"
        message:
          type: string
          description: Detailed error message
          example: "cidr_block is required"